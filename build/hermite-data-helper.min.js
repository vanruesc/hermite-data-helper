/**
 * hermite-data-helper v0.3.0 build May 31 2018
 * https://github.com/vanruesc/hermite-data-helper
 * Copyright 2018 Raoul van RÃ¼schen, Zlib
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("three")):"function"==typeof define&&define.amd?define(["three"],t):e.HERMITEDATAHELPER=t(e.THREE)}(this,function(k){"use strict";var t=function(){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}}(),w=0;return function(e){function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));n.name="HermiteDataHelper",n.cellPosition=e,n.cellSize=t,n.data=r,n.pointsMaterial=new k.PointsMaterial({vertexColors:k.VertexColors,sizeAttenuation:!0,size:.05}),n.add(new k.Group),n.add(new k.Group),n.add(new k.Group),n.gridPoints.name="GridPoints",n.edges.name="Edges",n.normals.name="Normals";try{n.update(i,o)}catch(e){}return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,k.Group),t(a,[{key:"validate",value:function(){var e=null;return null===this.cellPosition?e=new Error("The cell position is not defined"):this.cellSize<=0?e=new Error("Invalid cell size: "+this.cellSize):null===this.data?e=new Error("No data"):(this.data.empty&&(e=new Error("The provided data is empty")),this.data.compressed&&(e=new Error("The provided data must be uncompressed"))),e}},{key:"set",value:function(e,t,r){return this.cellPosition=e,this.cellSize=t,this.data=r,this}},{key:"update",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=this.data,i=this.validate();if(this.dispose(),null!==i)throw i;return e&&this.createPoints(r),t&&null!==r.edgeData&&this.createEdges(r),this}},{key:"createPoints",value:function(e){var t=e.materialIndices,r=Math.cbrt(t.length)-1,i=this.cellSize,o=this.cellPosition,n=new k.Vector3,a=new k.Vector3,l=new Float32Array([0,0,0]),s=new k.BufferGeometry,d=e.materials,u=new Float32Array(3*d),c=new Float32Array(3*d),f=void 0,h=void 0,v=void 0,y=void 0,p=void 0;for(v=p=y=0;v<=r;++v)for(n.z=v*i/r,h=0;h<=r;++h)for(n.y=h*i/r,f=0;f<=r;++f)n.x=f*i/r,t[y++]!==w&&(a.addVectors(o,n),u[p]=a.x,c[p++]=l[0],u[p]=a.y,c[p++]=l[1],u[p]=a.z,c[p++]=l[2]);s.addAttribute("position",new k.BufferAttribute(u,3)),s.addAttribute("color",new k.BufferAttribute(c,3)),this.gridPoints.add(new k.Points(s,this.pointsMaterial))}},{key:"createEdges",value:function(e){var t=e.edgeData,r=Math.cbrt(e.materialIndices.length)-1,i=this.cellSize,o=new k.Vector3,n=new k.Vector3,a=[t.edgesX(this.cellPosition,this.cellSize),t.edgesY(this.cellPosition,this.cellSize),t.edgesZ(this.cellPosition,this.cellSize)],l=[new Float32Array([.6,0,0]),new Float32Array([0,.6,0]),new Float32Array([0,0,.6])],s=new Float32Array([0,1,1]),d=new k.LineBasicMaterial({vertexColors:k.VertexColors}),u=void 0,c=void 0,f=void 0,h=void 0,v=void 0,y=void 0,p=void 0,w=void 0,g=void 0,b=void 0,m=void 0,A=void 0;for(b=A=m=0;b<3;++b,A=m=0)if(y=l[b],0<(w=a[b]).lengths.length){v=2*w.lengths[0],u=new Float32Array(3*v),c=new Float32Array(3*v),f=new Float32Array(3*v),h=new Float32Array(3*v);var P=!0,z=!1,E=void 0;try{for(var x,S=w[Symbol.iterator]();!(P=(x=S.next()).done);P=!0)g=x.value,u[m]=g.a.x,c[m++]=y[0],u[m]=g.a.y,c[m++]=y[1],u[m]=g.a.z,c[m++]=y[2],u[m]=g.b.x,c[m++]=y[0],u[m]=g.b.y,c[m++]=y[1],u[m]=g.b.z,c[m++]=y[2],g.computeZeroCrossingPosition(o),n.copy(o).addScaledVector(g.n,.25*i/r),f[A]=o.x,h[A++]=s[0],f[A]=o.y,h[A++]=s[1],f[A]=o.z,h[A++]=s[2],f[A]=n.x,h[A++]=s[0],f[A]=n.y,h[A++]=s[1],f[A]=n.z,h[A++]=s[2]}catch(e){z=!0,E=e}finally{try{!P&&S.return&&S.return()}finally{if(z)throw E}}(p=new k.BufferGeometry).addAttribute("position",new k.BufferAttribute(u,3)),p.addAttribute("color",new k.BufferAttribute(c,3)),this.edges.add(new k.LineSegments(p,d)),(p=new k.BufferGeometry).addAttribute("position",new k.BufferAttribute(f,3)),p.addAttribute("color",new k.BufferAttribute(h,3)),this.normals.add(new k.LineSegments(p,d))}}},{key:"dispose",value:function(){var e,t=void 0,r=void 0,i=void 0;for(i=0,e=this.children.length;i<e;++i)for(r=(t=this.children[i]).children;0<r.length;)r[0].geometry.dispose(),r[0].material.dispose(),t.remove(r[0])}},{key:"gridPoints",get:function(){return this.children[0]}},{key:"edges",get:function(){return this.children[1]}},{key:"normals",get:function(){return this.children[2]}}],[{key:"air",set:function(e){w=e}}]),a}()});