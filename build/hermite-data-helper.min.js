/**
 * hermite-data-helper v1.0.2 build Sat Feb 01 2020
 * https://github.com/vanruesc/hermite-data-helper
 * Copyright 2020 Raoul van RÃ¼schen
 * @license Zlib
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],t):t((e=e||self).HERMITEDATAHELPER={},e.THREE)}(this,(function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}var l=0,s=function(e){function s(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];r(this,s),(e=a(this,i(s).call(this))).name="HermiteDataHelper",e.cellPosition=n,e.cellSize=o,e.data=l,e.pointsMaterial=new t.PointsMaterial({vertexColors:t.VertexColors,sizeAttenuation:!0,size:.05}),e.add(new t.Group),e.add(new t.Group),e.add(new t.Group),e.gridPoints.name="GridPoints",e.edges.name="Edges",e.normals.name="Normals";try{e.update(u,c)}catch(e){}return e}var u,c,d;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(s,e),u=s,d=[{key:"air",set:function(e){l=e}}],(c=[{key:"validate",value:function(){var e=null;return null===this.cellPosition?e=new Error("The cell position is not defined"):this.cellSize<=0?e=new Error("Invalid cell size: "+this.cellSize):null===this.data?e=new Error("No data"):(this.data.empty&&(e=new Error("The provided data is empty")),this.data.compressed&&(e=new Error("The provided data must be uncompressed"))),e}},{key:"set",value:function(e,t,r){return this.cellPosition=e,this.cellSize=t,this.data=r,this}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.data,n=this.validate();if(this.dispose(),null!==n)throw n;return e&&this.createPoints(r),t&&null!==r.edgeData&&this.createEdges(r),this}},{key:"createPoints",value:function(e){var r,n,i,o,a,s=e.materialIndices,u=Math.cbrt(s.length)-1,c=this.cellSize,d=this.cellPosition,f=new t.Vector3,h=new t.Vector3,y=new Float32Array([0,0,0]),p=new t.BufferGeometry,w=e.materials,g=new Float32Array(3*w),v=new Float32Array(3*w);for(o=0,a=0,i=0;i<=u;++i)for(f.z=i*c/u,n=0;n<=u;++n)for(f.y=n*c/u,r=0;r<=u;++r)f.x=r*c/u,s[o++]!==l&&(h.addVectors(d,f),g[a]=h.x,v[a++]=y[0],g[a]=h.y,v[a++]=y[1],g[a]=h.z,v[a++]=y[2]);p.setAttribute("position",new t.BufferAttribute(g,3)),p.setAttribute("color",new t.BufferAttribute(v,3)),this.gridPoints.add(new t.Points(p,this.pointsMaterial))}},{key:"createEdges",value:function(e){var r,n,i,o,a,l,s,u,c,d,f,h,y=e.edgeData,p=Math.cbrt(e.materialIndices.length)-1,w=this.cellSize,g=new t.Vector3,v=new t.Vector3,b=[y.edgesX(this.cellPosition,this.cellSize),y.edgesY(this.cellPosition,this.cellSize),y.edgesZ(this.cellPosition,this.cellSize)],m=[new Float32Array([.6,0,0]),new Float32Array([0,.6,0]),new Float32Array([0,0,.6])],A=new Float32Array([0,1,1]),P=new t.LineBasicMaterial({vertexColors:t.VertexColors});for(f=0,h=0,d=0;d<3;++d,f=0,h=0)if(l=m[d],(u=b[d]).lengths.length>0){a=2*u.lengths[0],r=new Float32Array(3*a),n=new Float32Array(3*a),i=new Float32Array(3*a),o=new Float32Array(3*a);var z=!0,E=!1,x=void 0;try{for(var S,k=u[Symbol.iterator]();!(z=(S=k.next()).done);z=!0)c=S.value,r[f]=c.a.x,n[f++]=l[0],r[f]=c.a.y,n[f++]=l[1],r[f]=c.a.z,n[f++]=l[2],r[f]=c.b.x,n[f++]=l[0],r[f]=c.b.y,n[f++]=l[1],r[f]=c.b.z,n[f++]=l[2],c.computeZeroCrossingPosition(g),v.copy(g).addScaledVector(c.n,.25*w/p),i[h]=g.x,o[h++]=A[0],i[h]=g.y,o[h++]=A[1],i[h]=g.z,o[h++]=A[2],i[h]=v.x,o[h++]=A[0],i[h]=v.y,o[h++]=A[1],i[h]=v.z,o[h++]=A[2]}catch(e){E=!0,x=e}finally{try{z||null==k.return||k.return()}finally{if(E)throw x}}(s=new t.BufferGeometry).setAttribute("position",new t.BufferAttribute(r,3)),s.setAttribute("color",new t.BufferAttribute(n,3)),this.edges.add(new t.LineSegments(s,P)),(s=new t.BufferGeometry).setAttribute("position",new t.BufferAttribute(i,3)),s.setAttribute("color",new t.BufferAttribute(o,3)),this.normals.add(new t.LineSegments(s,P))}}},{key:"dispose",value:function(){var e,t,r,n;for(r=0,n=this.children.length;r<n;++r)for(t=(e=this.children[r]).children;t.length>0;)t[0].geometry.dispose(),t[0].material.dispose(),e.remove(t[0])}},{key:"gridPoints",get:function(){return this.children[0]}},{key:"edges",get:function(){return this.children[1]}},{key:"normals",get:function(){return this.children[2]}}])&&n(u.prototype,c),d&&n(u,d),s}(t.Group);e.HermiteDataHelper=s,Object.defineProperty(e,"__esModule",{value:!0})}));
