/**
 * hermite-data-helper v0.4.0 build Mon Jul 02 2018
 * https://github.com/vanruesc/hermite-data-helper
 * Copyright 2018 Raoul van RÃ¼schen, Zlib
 */
(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b(require('three')):'function'==typeof define&&define.amd?define(['three'],b):a.HERMITEDATAHELPER=b(a.THREE)})(this,function(a){'use strict';var b=function(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')},c=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),d=function(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)},e=function(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a},f=0,g=function(g){function h(){var c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,g=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3],i=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];b(this,h);var j=e(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));j.name='HermiteDataHelper',j.cellPosition=c,j.cellSize=d,j.data=f,j.pointsMaterial=new a.PointsMaterial({vertexColors:a.VertexColors,sizeAttenuation:!0,size:.05}),j.add(new a.Group),j.add(new a.Group),j.add(new a.Group),j.gridPoints.name='GridPoints',j.edges.name='Edges',j.normals.name='Normals';try{j.update(g,i)}catch(a){}return j}var k=Math.cbrt;return d(h,g),c(h,[{key:'validate',value:function(){var a=null;return null===this.cellPosition?a=new Error('The cell position is not defined'):0>=this.cellSize?a=new Error('Invalid cell size: '+this.cellSize):null===this.data?a=new Error('No data'):(this.data.empty&&(a=new Error('The provided data is empty')),this.data.compressed&&(a=new Error('The provided data must be uncompressed'))),a}},{key:'set',value:function(a,b,c){return this.cellPosition=a,this.cellSize=b,this.data=c,this}},{key:'update',value:function(){var a=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],b=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],c=this.data,d=this.validate();if(this.dispose(),null!==d)throw d;else a&&this.createPoints(c),b&&null!==c.edgeData&&this.createEdges(c);return this}},{key:'createPoints',value:function(b){var c=b.materialIndices,d=k(c.length)-1,e=this.cellSize,g=this.cellPosition,h=new a.Vector3,l=new a.Vector3,m=new Float32Array([0,0,0]),n=new a.BufferGeometry,o=b.materials,p=new Float32Array(3*o),q=new Float32Array(3*o),r=void 0,s=void 0,t=void 0,u=void 0,v=void 0;for(u=0,v=0,t=0;t<=d;++t)for(h.z=t*e/d,s=0;s<=d;++s)for(h.y=s*e/d,r=0;r<=d;++r)h.x=r*e/d,c[u++]!==f&&(l.addVectors(g,h),p[v]=l.x,q[v++]=m[0],p[v]=l.y,q[v++]=m[1],p[v]=l.z,q[v++]=m[2]);n.addAttribute('position',new a.BufferAttribute(p,3)),n.addAttribute('color',new a.BufferAttribute(q,3)),this.gridPoints.add(new a.Points(n,this.pointsMaterial))}},{key:'createEdges',value:function(b){var c=b.edgeData,e=k(b.materialIndices.length)-1,f=this.cellSize,g=new a.Vector3,h=new a.Vector3,l=[c.edgesX(this.cellPosition,this.cellSize),c.edgesY(this.cellPosition,this.cellSize),c.edgesZ(this.cellPosition,this.cellSize)],m=[new Float32Array([.6,0,0]),new Float32Array([0,.6,0]),new Float32Array([0,0,.6])],n=new Float32Array([0,1,1]),o=new a.LineBasicMaterial({vertexColors:a.VertexColors}),p=void 0,q=void 0,r=void 0,s=void 0,t=void 0,u=void 0,v=void 0,w=void 0,x=void 0,y=void 0,z=void 0,A=void 0;for(z=0,A=0,y=0;3>y;++y,z=0,A=0)if(u=m[y],w=l[y],0<w.lengths.length){t=2*w.lengths[0],p=new Float32Array(3*t),q=new Float32Array(3*t),r=new Float32Array(3*t),s=new Float32Array(3*t);var B=!0,C=!1,D=void 0;try{for(var E,F=w[Symbol.iterator]();!(B=(E=F.next()).done);B=!0)x=E.value,p[z]=x.a.x,q[z++]=u[0],p[z]=x.a.y,q[z++]=u[1],p[z]=x.a.z,q[z++]=u[2],p[z]=x.b.x,q[z++]=u[0],p[z]=x.b.y,q[z++]=u[1],p[z]=x.b.z,q[z++]=u[2],x.computeZeroCrossingPosition(g),h.copy(g).addScaledVector(x.n,.25*f/e),r[A]=g.x,s[A++]=n[0],r[A]=g.y,s[A++]=n[1],r[A]=g.z,s[A++]=n[2],r[A]=h.x,s[A++]=n[0],r[A]=h.y,s[A++]=n[1],r[A]=h.z,s[A++]=n[2]}catch(a){C=!0,D=a}finally{try{!B&&F.return&&F.return()}finally{if(C)throw D}}v=new a.BufferGeometry,v.addAttribute('position',new a.BufferAttribute(p,3)),v.addAttribute('color',new a.BufferAttribute(q,3)),this.edges.add(new a.LineSegments(v,o)),v=new a.BufferGeometry,v.addAttribute('position',new a.BufferAttribute(r,3)),v.addAttribute('color',new a.BufferAttribute(s,3)),this.normals.add(new a.LineSegments(v,o))}}},{key:'dispose',value:function(){var a=void 0,b=void 0,c=void 0,d=void 0;for(c=0,d=this.children.length;c<d;++c)for(a=this.children[c],b=a.children;0<b.length;)b[0].geometry.dispose(),b[0].material.dispose(),a.remove(b[0])}},{key:'gridPoints',get:function(){return this.children[0]}},{key:'edges',get:function(){return this.children[1]}},{key:'normals',get:function(){return this.children[2]}}],[{key:'air',set:function(a){f=a}}]),h}(a.Group);return g});
