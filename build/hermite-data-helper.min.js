/**
 * hermite-data-helper v1.0.4 build Wed Mar 25 2020
 * https://github.com/vanruesc/hermite-data-helper
 * Copyright 2020 Raoul van RÃ¼schen
 * @license Zlib
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],t):t((e=e||self).HERMITEDATAHELPER={},e.THREE)}(this,(function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function u(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(e){if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(e,t):void 0}}(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,i=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return i=e.done,e},e:function(e){a=!0,o=e},f:function(){try{i||null==n.return||n.return()}finally{if(a)throw o}}}}var c=0,f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(p,e);var s,f,d,h,y=(s=p,function(){var e,t=o(s);if(a()){var r=o(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return l(this,e)});function p(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];r(this,p),(e=y.call(this)).name="HermiteDataHelper",e.cellPosition=n,e.cellSize=o,e.data=i,e.pointsMaterial=new t.PointsMaterial({vertexColors:t.VertexColors,sizeAttenuation:!0,size:.05}),e.add(new t.Group),e.add(new t.Group),e.add(new t.Group),e.gridPoints.name="GridPoints",e.edges.name="Edges",e.normals.name="Normals";try{e.update(a,l)}catch(e){}return e}return f=p,h=[{key:"air",set:function(e){c=e}}],(d=[{key:"validate",value:function(){var e=null;return null===this.cellPosition?e=new Error("The cell position is not defined"):this.cellSize<=0?e=new Error("Invalid cell size: "+this.cellSize):null===this.data?e=new Error("No data"):(this.data.empty&&(e=new Error("The provided data is empty")),this.data.compressed&&(e=new Error("The provided data must be uncompressed"))),e}},{key:"set",value:function(e,t,r){return this.cellPosition=e,this.cellSize=t,this.data=r,this}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.data,n=this.validate();if(this.dispose(),null!==n)throw n;return e&&this.createPoints(r),t&&null!==r.edgeData&&this.createEdges(r),this}},{key:"createPoints",value:function(e){var r,n,o,i,a,l=e.materialIndices,s=Math.cbrt(l.length)-1,u=this.cellSize,f=this.cellPosition,d=new t.Vector3,h=new t.Vector3,y=new Float32Array([0,0,0]),p=new t.BufferGeometry,w=e.materials,v=new Float32Array(3*w),g=new Float32Array(3*w);for(i=0,a=0,o=0;o<=s;++o)for(d.z=o*u/s,n=0;n<=s;++n)for(d.y=n*u/s,r=0;r<=s;++r)d.x=r*u/s,l[i++]!==c&&(h.addVectors(f,d),v[a]=h.x,g[a++]=y[0],v[a]=h.y,g[a++]=y[1],v[a]=h.z,g[a++]=y[2]);p.setAttribute("position",new t.BufferAttribute(v,3)),p.setAttribute("color",new t.BufferAttribute(g,3)),this.gridPoints.add(new t.Points(p,this.pointsMaterial))}},{key:"createEdges",value:function(e){var r,n,o,i,a,l,s,c,f,d,h,y,p=e.edgeData,w=Math.cbrt(e.materialIndices.length)-1,v=this.cellSize,g=new t.Vector3,b=new t.Vector3,m=[p.edgesX(this.cellPosition,this.cellSize),p.edgesY(this.cellPosition,this.cellSize),p.edgesZ(this.cellPosition,this.cellSize)],A=[new Float32Array([.6,0,0]),new Float32Array([0,.6,0]),new Float32Array([0,0,.6])],P=new Float32Array([0,1,1]),S=new t.LineBasicMaterial({vertexColors:t.VertexColors});for(h=0,y=0,d=0;d<3;++d,h=0,y=0)if(l=A[d],(c=m[d]).lengths.length>0){a=2*c.lengths[0],r=new Float32Array(3*a),n=new Float32Array(3*a),o=new Float32Array(3*a),i=new Float32Array(3*a);var z,E=u(c);try{for(E.s();!(z=E.n()).done;)f=z.value,r[h]=f.a.x,n[h++]=l[0],r[h]=f.a.y,n[h++]=l[1],r[h]=f.a.z,n[h++]=l[2],r[h]=f.b.x,n[h++]=l[0],r[h]=f.b.y,n[h++]=l[1],r[h]=f.b.z,n[h++]=l[2],f.computeZeroCrossingPosition(g),b.copy(g).addScaledVector(f.n,.25*v/w),o[y]=g.x,i[y++]=P[0],o[y]=g.y,i[y++]=P[1],o[y]=g.z,i[y++]=P[2],o[y]=b.x,i[y++]=P[0],o[y]=b.y,i[y++]=P[1],o[y]=b.z,i[y++]=P[2]}catch(e){E.e(e)}finally{E.f()}(s=new t.BufferGeometry).setAttribute("position",new t.BufferAttribute(r,3)),s.setAttribute("color",new t.BufferAttribute(n,3)),this.edges.add(new t.LineSegments(s,S)),(s=new t.BufferGeometry).setAttribute("position",new t.BufferAttribute(o,3)),s.setAttribute("color",new t.BufferAttribute(i,3)),this.normals.add(new t.LineSegments(s,S))}}},{key:"dispose",value:function(){var e,t,r,n;for(r=0,n=this.children.length;r<n;++r)for(t=(e=this.children[r]).children;t.length>0;)t[0].geometry.dispose(),t[0].material.dispose(),e.remove(t[0])}},{key:"gridPoints",get:function(){return this.children[0]}},{key:"edges",get:function(){return this.children[1]}},{key:"normals",get:function(){return this.children[2]}}])&&n(f.prototype,d),h&&n(f,h),p}(t.Group);e.HermiteDataHelper=f,Object.defineProperty(e,"__esModule",{value:!0})}));
