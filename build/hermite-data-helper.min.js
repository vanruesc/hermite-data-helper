/**
 * hermite-data-helper v0.2.1 build Mar 16 2018
 * https://github.com/vanruesc/hermite-data-helper
 * Copyright 2018 Raoul van RÃ¼schen, Zlib
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("three")):"function"==typeof define&&define.amd?define(["three"],t):e.HERMITEDATAHELPER=t(e.THREE)}(this,function(e){"use strict";var t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},o=0;return function(n){function a(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];t(this,a);var d=i(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));d.name="HermiteDataHelper",d.cellPosition=r,d.cellSize=o,d.data=n,d.pointsMaterial=new e.PointsMaterial({vertexColors:e.VertexColors,sizeAttenuation:!0,size:.05}),d.add(new e.Group),d.add(new e.Group),d.add(new e.Group),d.gridPoints.name="GridPoints",d.edges.name="Edges",d.normals.name="Normals";try{d.update(l,s)}catch(e){}return d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,e.Group),r(a,[{key:"validate",value:function(){var e=null;return null===this.cellPosition?e=new Error("The cell position is not defined"):this.cellSize<=0?e=new Error("Invalid cell size: "+this.cellSize):null===this.data?e=new Error("No data"):(this.data.empty&&(e=new Error("The provided data is empty")),this.data.compressed&&(e=new Error("The provided data must be uncompressed"))),e}},{key:"set",value:function(e,t,r){return this.cellPosition=e,this.cellSize=t,this.data=r,this}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.data,i=this.validate();if(this.dispose(),null!==i)throw i;return e&&this.createPoints(r),t&&null!==r.edgeData&&this.createEdges(r),this}},{key:"createPoints",value:function(t){var r=t.materialIndices,i=Math.cbrt(r.length)-1,n=this.cellSize,a=this.cellPosition,l=new e.Vector3,s=new e.Vector3,d=new Float32Array([0,0,0]),u=new e.BufferGeometry,c=t.materials,f=new Float32Array(3*c),h=new Float32Array(3*c),v=void 0,y=void 0,p=void 0,w=void 0,g=void 0;for(w=0,g=0,p=0;p<=i;++p)for(l.z=p*n/i,y=0;y<=i;++y)for(l.y=y*n/i,v=0;v<=i;++v)l.x=v*n/i,r[w++]!==o&&(s.addVectors(a,l),f[g]=s.x,h[g++]=d[0],f[g]=s.y,h[g++]=d[1],f[g]=s.z,h[g++]=d[2]);u.addAttribute("position",new e.BufferAttribute(f,3)),u.addAttribute("color",new e.BufferAttribute(h,3)),this.gridPoints.add(new e.Points(u,this.pointsMaterial))}},{key:"createEdges",value:function(t){var r=t.edgeData,i=Math.cbrt(t.materialIndices.length)-1,o=this.cellSize,n=new e.Vector3,a=new e.Vector3,l=[r.edgesX(this.cellPosition,this.cellSize),r.edgesY(this.cellPosition,this.cellSize),r.edgesZ(this.cellPosition,this.cellSize)],s=[new Float32Array([.6,0,0]),new Float32Array([0,.6,0]),new Float32Array([0,0,.6])],d=new Float32Array([0,1,1]),u=new e.LineBasicMaterial({vertexColors:e.VertexColors}),c=void 0,f=void 0,h=void 0,v=void 0,y=void 0,p=void 0,w=void 0,g=void 0,b=void 0,m=void 0,A=void 0,P=void 0;for(A=0,P=0,m=0;m<3;++m,A=0,P=0)if(p=s[m],(g=l[m]).lengths.length>0){y=2*g.lengths[0],c=new Float32Array(3*y),f=new Float32Array(3*y),h=new Float32Array(3*y),v=new Float32Array(3*y);var z=!0,E=!1,x=void 0;try{for(var S,k=g[Symbol.iterator]();!(z=(S=k.next()).done);z=!0)b=S.value,c[A]=b.a.x,f[A++]=p[0],c[A]=b.a.y,f[A++]=p[1],c[A]=b.a.z,f[A++]=p[2],c[A]=b.b.x,f[A++]=p[0],c[A]=b.b.y,f[A++]=p[1],c[A]=b.b.z,f[A++]=p[2],b.computeZeroCrossingPosition(n),a.copy(n).addScaledVector(b.n,.25*o/i),h[P]=n.x,v[P++]=d[0],h[P]=n.y,v[P++]=d[1],h[P]=n.z,v[P++]=d[2],h[P]=a.x,v[P++]=d[0],h[P]=a.y,v[P++]=d[1],h[P]=a.z,v[P++]=d[2]}catch(e){E=!0,x=e}finally{try{!z&&k.return&&k.return()}finally{if(E)throw x}}(w=new e.BufferGeometry).addAttribute("position",new e.BufferAttribute(c,3)),w.addAttribute("color",new e.BufferAttribute(f,3)),this.edges.add(new e.LineSegments(w,u)),(w=new e.BufferGeometry).addAttribute("position",new e.BufferAttribute(h,3)),w.addAttribute("color",new e.BufferAttribute(v,3)),this.normals.add(new e.LineSegments(w,u))}}},{key:"dispose",value:function(){var e,t=void 0,r=void 0,i=void 0;for(i=0,e=this.children.length;i<e;++i)for(r=(t=this.children[i]).children;r.length>0;)r[0].geometry.dispose(),r[0].material.dispose(),t.remove(r[0])}},{key:"gridPoints",get:function(){return this.children[0]}},{key:"edges",get:function(){return this.children[1]}},{key:"normals",get:function(){return this.children[2]}}],[{key:"air",set:function(e){o=e}}]),a}()});